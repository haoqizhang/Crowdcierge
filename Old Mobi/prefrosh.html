
<html>
<head>
    <title>Mobi Prefrosh</title>
    <style type="text/css">

 *{margin:0;padding:0;margin-top:0;margin-bottom:0}
</style>
</head>
<body>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js"></script>

<script>
    
var tid = null;
var uid = null;
var baselink = null;
var mobilink = "interface/mobi-tour.html";

function unescapeURL(s) {
    return decodeURIComponent(s.replace(/\+/g, "%20"))
}

function loadUserInfo() {
var status =false;

    jQuery.ajax({
	    type: "GET",
		url: "http://people.csail.mit.edu/hqz/mobi/loadTourUserInfo.php",
               async : false,
		data: ({
			userId : uid,
		       taskId: tid, 
		       type: "tour"}),
		success: function(obj){
		 if(obj == ""){
status = false;
		 }else{
               status = true;
		 }      
	    }
	 });
return status;
}

function getURLParams() {
    var params = {}
    var m = window.location.href.match(/[\\?&]([^=]+)=([^&#]*)/g)
    if (m) {
        for (var i = 0; i < m.length; i++) {
            var a = m[i].match(/.([^=]+)=(.*)/)
            params[unescapeURL(a[1])] = unescapeURL(a[2])
        }
    }
    return params
}

function readUrlParameters(){
  var params = getURLParams();		       
  if(params.tid){
      tid = params.tid;
  }
  
  if(params.uid){
      uid = params.uid;
  }
}


function DetermineBaselink(){
    baselink = mobilink;
    return;
}


function Navigate(){
    var newurl = baselink;
    if(tid || uid) {
	newurl += "?";
    }
    if(tid != null && uid != null) {
	newurl += "tid=";
	newurl += tid;
	newurl += "&uid=";
	newurl += uid;
    }
    if(tid && !uid) newurl = newurl + "tid=" + tid;
    if(!tid && uid) newurl = newurl + "uid=" + uid;

    goTo(newurl);
}

function moveOn(){
    baselink = mobilink;
    Navigate();			    
}

function goTo(url){
   $('#mobi-frame').attr('src', url);
}

jQuery(function(){
	readUrlParameters();
	if(!tid || !uid){
           goTo("http://people.csail.mit.edu/hqz/mobi/Mobi/");
       }else if(!loadUserInfo()){
	   goTo("http://people.csail.mit.edu/hqz/mobi/Mobi/");
      }else{// ready to navigate
    DetermineBaselink();
		
	    Navigate();
	}
    });
</script>
    <iframe id="mobi-frame" src="" width="100%" height="100%" frameborder="0" hspace="0" vspace="0" marginheight="0" marginwidth="0" style="border-width:0;border-style:hidden;">
      <p>Your browser does not support iframes.</p>
    </iframe>

</body>
</html>

